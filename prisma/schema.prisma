//@/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Producto {
  id          Int       @id @default(autoincrement())
  nombre      String?   @db.VarChar(20)
  info        String?   @db.VarChar(255)
  precio      Float     @default(0)
  stock       Int       @default(0)
  estado      Boolean   @default(true)
  marcaId     Int
  categoriaId Int
  proveedorId Int
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  pedidos     Pedido[]
  categoria   Categoria @relation(fields: [categoriaId], references: [id], onDelete: NoAction)
  marca       Marca     @relation(fields: [marcaId], references: [id])
  proveedor   Proveedor @relation(fields: [proveedorId], references: [id])

  @@index([categoriaId], map: "productos_categoriaId_fkey")
  @@index([marcaId], map: "productos_marcaId_fkey")
  @@index([proveedorId], map: "productos_proveedorId_fkey")
  @@map("productos")
}

model Categoria {
  id        Int        @id @default(autoincrement())
  nombre    String?    @db.VarChar(20)
  info      String?    @db.VarChar(255)
  estado    Boolean?   @default(true)
  productos Producto[]

  @@map("categorias")
}

model Marca {
  id          Int                  @id @default(autoincrement())
  nombre      String?              @db.VarChar(20)
  info        String?              @db.VarChar(255)
  estado      Boolean?             @default(true)
  proveedores proveedores_marcas[]
  productos   Producto[]

  @@map("marcas")
}

model Cliente {
  id       Int      @id @default(autoincrement())
  nombre   String?  @db.VarChar(20)
  info     String?  @db.VarChar(255)
  estado   Boolean? @default(true)
  email    String?
  telefono String?
  saldo    Float    @default(0)
  ventas   Venta[]
  cobros   Cobro[]

  @@map("clientes")
}

model Proveedor {
  id        Int                  @id @default(autoincrement())
  nombre    String?              @db.VarChar(20)
  info      String?              @db.VarChar(255)
  estado    Boolean?             @default(true)
  email     String?
  telefono  String?
  marcas    proveedores_marcas[]
  productos Producto[]
  pagos     Pago[]
  compras   Compra[]

  @@map("proveedores")
}

model Compra {
  id        Int       @id @default(autoincrement())
  fecha     DateTime? @default(now())
  info      String?   @db.VarChar(255)
  estado    Boolean?  @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  total     Float?    @default(0)
  saldo     Float?    @default(0)

  proveedorId Int
  proveedor   Proveedor @relation(fields: [proveedorId], references: [id], map: "Compra_proveedorId_fkey")
  pedidos     Pedido[]
  pagos       Pago[]

  @@index([proveedorId], map: "Compra_proveedorId_fkey")
  @@map("compras")
}

model Venta {
  id        Int       @id @default(autoincrement())
  fecha     DateTime? @default(now())
  info      String?   @db.VarChar(255)
  estado    Boolean?  @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  total     Float?    @default(0)
  saldo     Float?    @default(0)

  clienteId Int
  cliente   Cliente  @relation(fields: [clienteId], references: [id], map: "Venta_clienteId_fkey")
  pedidos   Pedido[]
  cobros    Cobro[]

  @@index([clienteId], map: "Venta_clienteId_fkey")
  @@map("ventas")
}

model Pedido {
  id         Int      @id @default(autoincrement())
  cantidad   Int
  precio     Float
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  productoId Int
  producto   Producto @relation(fields: [productoId], references: [id])
  ventaId    Int?
  venta      Venta?   @relation(fields: [ventaId], references: [id], onDelete: Cascade)
  compraId   Int?
  compra     Compra?  @relation(fields: [compraId], references: [id], onDelete: Cascade)

  @@index([productoId], map: "Pedido_productoId_fkey")
  @@map("pedidos")
}

model Pago {
  id        Int      @id @default(autoincrement())
  fecha     DateTime @default(now())
  monto     Float
  formaPago String?
  nota      String?

  proveedorId Int
  proveedor   Proveedor @relation(fields: [proveedorId], references: [id])
  compraId    Int?
  compra      Compra?   @relation(fields: [compraId], references: [id])
  cajaId      Int
  caja        Caja?     @relation(fields: [cajaId], references: [id])

  @@map("pagos")
}

model Cobro {
  id        Int      @id @default(autoincrement())
  fecha     DateTime @default(now())
  monto     Float
  formaPago String?
  nota      String?

  clienteId Int
  cliente   Cliente @relation(fields: [clienteId], references: [id])
  cajaId    Int?
  caja      Caja?   @relation(fields: [cajaId], references: [id])
  ventaId   Int?
  venta     Venta?  @relation(fields: [ventaId], references: [id])

  @@map("cobros")
}

model Caja {
  id            Int       @id @default(autoincrement())
  nombre        String?
  saldo         Float?    @default(0)
  estado        Boolean?  @default(true)
  fechaApertura DateTime  @default(now())
  fechaCierre   DateTime?
  ingresos      Cobro[]
  egresos       Pago[]

  @@map("cajas")
}

model proveedores_marcas {
  marcaId     Int
  proveedorId Int
  marcas      Marca     @relation(fields: [marcaId], references: [id], onDelete: Cascade, map: "_marcatoproveedor_A_fkey")
  proveedores Proveedor @relation(fields: [proveedorId], references: [id], onDelete: Cascade, map: "_marcatoproveedor_B_fkey")

  @@unique([marcaId, proveedorId], map: "_marcatoproveedor_AB_unique")
  @@index([proveedorId], map: "_marcatoproveedor_B_index")
  @@map("_proveedores_marcas")
}
